{"version":3,"sources":["webpack:///./src/views/DocEdit.vue?5394","webpack:///./src/views/DocEdit.vue?9522","webpack:///src/views/DocEdit.vue","webpack:///./src/views/DocEdit.vue?e9f7","webpack:///./src/views/DocEdit.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","showData","attrs","model","value","doc","callback","$$v","$set","expression","on","save","abort","_e","ref","staticStyle","content","toolbars","imgAdd","change","staticRenderFns","data","actionPath","photoUrl","ownerName","count","createTime","updateTime","docName","bold","italic","header","underline","strikethrough","mark","superscript","subscript","quote","ol","ul","link","imagelink","code","table","fullscreen","readmodel","htmlcode","help","undo","redo","trash","navigation","alignleft","aligncenter","alignright","subfield","preview","methods","beforeUpload","checkFileType","$message","error","checkFileSize","file","policy","scope","bucketName","deadline","token","form","append","$vm","$img2Url","pos","console","log","undefined","length","id","$store","state","userId","did","$route","query","docId","name","res","result","path","$router","push","mounted","window","onbeforeunload","toString","edit","lock","d","confirmButtonText","component"],"mappings":"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","file":"js/chunk-1a6ac3c0.643e1393.js","sourcesContent":["import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DocEdit.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DocEdit.vue?vue&type=style&index=0&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (this.showData===true)?_c('el-main',[(this.showData===true)?_c('el-row',[_c('el-col',{attrs:{\"span\":8,\"offset\":6}},[_c('el-input',{attrs:{\"id\":\"tt\"},model:{value:(_vm.doc.docName),callback:function ($$v) {_vm.$set(_vm.doc, \"docName\", $$v)},expression:\"doc.docName\"}})],1),_c('el-col',{attrs:{\"span\":2,\"offset\":2}},[_c('el-button',{attrs:{\"type\":\"success\",\"icon\":\"el-icon-check\",\"circle\":\"\",\"plain\":\"\"},on:{\"click\":_vm.save}}),_c('el-button',{attrs:{\"type\":\"warning\",\"icon\":\"el-icon-close\",\"circle\":\"\",\"plain\":\"\"},on:{\"click\":_vm.abort}})],1)],1):_vm._e(),_c('p'),_c('el-row',[_c('el-col',{attrs:{\"span\":12,\"offset\":6}},[(this.showData===true)?_c('mavon-editor',{ref:\"editor\",staticStyle:{\"min-height\":\"1000px\"},attrs:{\"value\":_vm.doc.content,\"toolbars\":_vm.toolbars,\"placeholder\":\"在这里输入文档内容\",\"defaultOpen\":\"edit\",\"editable\":true,\"toolbarsBackground\":\"#E6E6E6\",\"subfield\":false,\"ishljs\":true,\"scrollStyle\":true},on:{\"imgAdd\":_vm.imgAdd,\"change\":_vm.change}}):_vm._e()],1)],1)],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <el-main v-if=\"this.showData===true\">\n    <el-row v-if=\"this.showData===true\">\n      <el-col :span=\"8\" :offset=\"6\">\n        <el-input id=\"tt\" v-model=\"doc.docName\"></el-input>\n        <!--        <div class=\"title\">-->\n        <!--          {{doc.docName}}-->\n        <!--        </div>-->\n      </el-col>\n      <el-col :span=\"2\" :offset=\"2\">\n        <el-button type=\"success\" icon=\"el-icon-check\" circle plain @click=\"save\"></el-button>\n        <!--save-->\n        <el-button type=\"warning\" icon=\"el-icon-close\" circle plain @click=\"abort\"></el-button>\n        <!--abort-->\n      </el-col>\n    </el-row>\n    <p></p>\n    <el-row>\n      <el-col :span=\"12\" :offset=\"6\">\n        <mavon-editor\n          v-if=\"this.showData===true\"\n          style=\"min-height: 1000px;\"\n          ref=\"editor\"\n          :value=\"doc.content\"\n          :toolbars=\"toolbars\"\n          placeholder=\"在这里输入文档内容\"\n          defaultOpen=\"edit\"\n          :editable=\"true\"\n          toolbarsBackground=\"#E6E6E6\"\n          :subfield=\"false\"\n          @imgAdd=\"imgAdd\"\n          :ishljs=\"true\"\n          :scrollStyle=\"true\"\n          @change=\"change\"\n        ></mavon-editor>\n      </el-col>\n    </el-row>\n  </el-main>\n</template>\n\n<script>\nimport { genToken } from \"../genToken\";\nimport random from \"string-random\";\nimport axios from \"axios\";\nimport {\n  AbortFile,\n  EditFile,\n  GetAuth,\n  GetFile,\n  GetUserInfo,\n  SaveFile,\n} from \"../main\";\n\nexport default {\n  data() {\n    return {\n      actionPath: \"https://upload.qiniup.com\", // 华东\n      photoUrl: \"http://qexiy12gt.hd-bkt.clouddn.com/\", //外链域名\n      doc: {\n        ownerName: \"\",\n        content: \"\",\n        count: \"\",\n        createTime: \"\",\n        updateTime: \"\",\n        docName: \"\",\n      },\n      showData: false,\n      //showData: true,\n      toolbars: {\n        bold: true, // 粗体\n        italic: true, // 斜体\n        header: true, // 标题\n        underline: true, // 下划线\n        strikethrough: true, // 中划线\n        mark: true, // 标记\n        superscript: true, // 上角标\n        subscript: true, // 下角标\n        quote: true, // 引用\n        ol: true, // 有序列表\n        ul: true, // 无序列表\n        link: true, // 链接\n        imagelink: true, // 图片链接\n        code: true, // code\n        table: true, // 表格\n        fullscreen: true, // 全屏编辑\n        readmodel: true, // 沉浸式阅读\n        htmlcode: false, // 展示html源码\n        help: false, // 帮助\n        undo: true, // 上一步\n        redo: true, // 下一步\n        trash: false, // 清空\n        save: false, // 保存（触发events中的save事件）\n        navigation: true, // 导航目录\n        alignleft: true, // 左对齐\n        aligncenter: true, // 居中\n        alignright: true, // 右对齐\n        subfield: false, // 单双栏模式\n        preview: true, // 预览\n      },\n    };\n  },\n  methods: {\n    beforeUpload(file) {\n      const checkFileType =\n        file.type === \"image/jpeg\" ||\n        file.type === \"image/jpg\" ||\n        file.type === \"image/png\";\n      const checkFileSize = file.size / 1024 / 1024 < 5;\n      if (!checkFileType) {\n        this.$message.error(\"上传图片必须是 jpeg/jpg/png 格式！\");\n      }\n      if (!checkFileSize) {\n        this.$message.error(\"上传图片大小不能超过 5MB！\");\n      }\n      return checkFileType && checkFileSize;\n    },\n\n    imgAdd(pos, file) {\n      if (!this.beforeUpload(file)) {\n        return;\n      }\n      let token;\n      const policy = {};\n      const bucketName = \"domaint\";\n      const AK = \"K96MCAU7eCnSWz4XUbxIBe9Q9PUm_gBHfacmsAEf\";\n      const SK = \"g0eagx-yjztmAo0iVi-Nj8QrsCRGrKhdGKIjpVr9\";\n      const deadline = 1599840000; // 2020-09-12\n      policy.scope = bucketName;\n      policy.deadline = deadline;\n      token = genToken(AK, SK, policy);\n      let $vm = this.$refs.editor;\n\n      let form = new FormData();\n      form.append(\"file\", file);\n      form.append(\"token\", token);\n      form.append(\"key\", random(16));\n      axios.post(this.actionPath, form).then((res) => {\n        $vm.$img2Url(pos, this.photoUrl + res.data.key);\n      });\n    },\n\n    save() {\n      console.log(\"[save]:\");\n      console.log(this.doc.docName);\n      console.log(this.doc.content);\n      if (this.doc.docName === \"\" || this.doc.docName === undefined) {\n        this.$message.error(\"文档名不能为空！\");\n        return;\n      }\n      if (this.doc.docName.length > 16) {\n        this.$message.error(\"文档名长度不能超过16！\");\n        return;\n      }\n      SaveFile({\n        id: this.$store.state.userId,\n        did: this.$route.query.docId,\n        name: this.doc.docName,\n        content: this.doc.content,\n      }).then((res) => {\n        if (res.data.result === false) {\n          this.$message.error(\"保存失败，请稍后再试\");\n          return;\n        } else {\n          this.$message(\"保存成功\");\n          this.$router.push({\n            path: \"/docBrowse\",\n            query: { docId: this.$route.query.docId },\n          });\n        }\n      });\n    },\n\n    abort() {\n      AbortFile({\n        id: this.$store.state.userId,\n        did: this.$route.query.docId,\n      });\n      this.$router.push({\n        path: \"/docBrowse\",\n        query: { docId: this.$route.query.docId },\n      });\n    },\n\n    change(value, render) {\n      this.doc.content = value;\n    },\n  },\n  mounted() {\n    window.onbeforeunload = () => {\n      AbortFile({\n        id: this.$store.state.userId.toString(),\n        did: this.$route.query.docId.toString(),\n      });\n    }\n    GetAuth({\n      id: this.$store.state.userId.toString(),\n      did: this.$route.query.docId.toString(),\n    }).then((res) => {\n      if (res.data.edit === false) {\n        this.$alert(\"无文档编辑权限\", \"出错啦\", {\n          confirmButtonText: \"确定\",\n          callback: (action) => {\n            this.$router.go(-1);\n          },\n        });\n        return;\n      }\n      if (res.data.lock === true) {\n        this.$alert(\"文档正在被他人编辑中，请稍后再试\", \"出错啦\", {\n          confirmButtonText: \"确定\",\n          callback: (action) => {\n            this.$router.go(-1);\n          },\n        });\n        return;\n      }\n      EditFile({\n        id: this.$store.state.userId.toString(),\n        did: this.$route.query.docId.toString(),\n      });\n      GetFile({ id: this.$route.query.docId.toString() }).then((res) => {\n        let d = res.data;\n        if (d.result === false) {\n          this.$message.error(\"请求文档失败！请稍后再试！\");\n          return;\n        }\n        GetUserInfo({ id: d.owner.toString() }).then((res) => {\n          this.doc.ownerName = res.data.username;\n        });\n        this.doc.createTime = d.createTime;\n        this.doc.updateTime = d.updateTime;\n        this.doc.content = d.content;\n        this.doc.docName = d.name;\n        this.showData = true;\n        console.log(this.doc.docName);\n      });\n    });\n  },\n};\n</script>\n<style>\n.back {\n  width: 100%;\n  height: 50px;\n  position: fixed;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DocEdit.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DocEdit.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./DocEdit.vue?vue&type=template&id=690880dc&\"\nimport script from \"./DocEdit.vue?vue&type=script&lang=js&\"\nexport * from \"./DocEdit.vue?vue&type=script&lang=js&\"\nimport style0 from \"./DocEdit.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}